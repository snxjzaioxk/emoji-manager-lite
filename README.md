# Emoji Manager Lite v4.2.0

一款专为电脑用户设计的本地表情包管理工具，支持表情包的统一存储、分类和管理功能。

> **v4.2.0 极致内存优化版本** - 内存占用降低 70-80%，从 400MB 降至 120MB！

## 功能特性

### 🚀 核心功能
- **批量导入**：支持从本地文件夹批量导入表情包，支持 JPG、PNG、GIF、WebP 等格式
- **拖拽导入**：支持拖拽单个或多个文件/文件夹直接导入
- **智能分类**：自定义分类和标签系统，支持多级文件夹结构
- **快速搜索**：关键字搜索，支持按格式、尺寸、时间筛选
- **收藏管理**：常用表情包收藏功能
- **重复检测**：自动识别并提示重复表情包
- **全屏预览**：全新图像预览组件，支持大图查看和详细操作 (v2.3.0新增)

### 🛠️ 实用工具
- **一键复制**：快速复制表情包到剪贴板
- **格式转换**：支持常见格式间的相互转换
- **批量操作**：批量重命名、批量删除
- **使用统计**：记录最常使用的表情包
- **导出功能**：支持将表情包导出到指定文件夹
- **智能错误处理**：用户友好的错误提示和处理机制 (v2.3.0新增)

### 🎨 界面设计
- **现代化界面**：简洁美观的用户界面
- **主题切换**：支持深色/浅色主题
- **视图模式**：网格视图和列表视图切换
- **响应式设计**：适配不同屏幕尺寸
- **触控友好**：专门优化触控设备使用体验 (v2.3.0新增)
- **无障碍支持**：高对比度模式和减动效模式支持 (v2.3.0新增)

### 🔧 技术特性
- **TypeScript支持**：完整的类型定义，提升开发体验 (v2.3.0新增)
- **性能优化**：懒加载和防抖处理，提升应用响应速度 (v2.3.0新增)
- **错误恢复**：智能错误识别和恢复机制 (v2.3.0新增)
- **快捷键支持**：ESC关闭、Ctrl+C复制、F切换收藏 (v2.3.0新增)

## 技术架构

- **前端框架**：React + TypeScript
- **桌面框架**：Electron
- **数据库**：SQLite
- **图像处理**：Sharp
- **构建工具**：Vite
- **UI 组件**：Lucide React Icons

## 开发环境

### 系统要求
- Node.js 18+
- npm 或 yarn
- Windows 10+ / macOS 10.14+ / Linux

### 安装依赖

```bash
npm install
```

### 开发模式

```bash
npm run dev
```

这将同时启动主进程和渲染进程的开发服务器。

### 构建应用

```bash
npm run build
```

### 打包应用

```bash
npm run package
```

## 项目结构

```
emoji-manager-lite/
├── src/
│   ├── main/           # Electron 主进程
│   │   ├── main.ts     # 主进程入口
│   │   ├── database.ts # 数据库管理
│   │   ├── fileManager.ts # 文件管理
│   │   └── preload.ts  # 预加载脚本
│   ├── renderer/       # 渲染进程 (React)
│   │   ├── src/
│   │   │   ├── components/ # React 组件
│   │   │   │   ├── EmojiCard.tsx      # 表情包卡片组件
│   │   │   │   ├── EmojiGrid.tsx      # 网格视图组件
│   │   │   │   ├── EmojiListItem.tsx  # 列表项组件
│   │   │   │   └── ImagePreview.tsx   # 图像预览组件 (新增)
│   │   │   ├── styles/        # 样式文件 (新增)
│   │   │   │   └── touch-accessibility.css # 触控友好样式 (新增)
│   │   │   ├── types/         # TypeScript 类型定义 (新增)
│   │   │   │   └── global.d.ts    # 全局类型声明 (新增)
│   │   │   ├── App.tsx        # 主应用组件
│   │   │   └── main.tsx       # 渲染进程入口
│   │   └── index.html
│   └── shared/         # 共享模块 (重构)
│       ├── types.ts     # 共享类型定义
│       ├── errorHandling.ts # 错误处理工具 (新增)
│       └── utils.ts     # 工具函数库 (新增)
├── public/             # 静态资源
├── assets/             # 应用图标等
├── dist/               # 构建输出
└── release/            # 打包输出
```

### 新增文件说明

**v2.3.0 新增的核心文件：**

- **`src/renderer/src/components/ImagePreview.tsx`** - 全新图像预览组件
- **`src/renderer/src/styles/touch-accessibility.css`** - 触控设备友好样式
- **`src/renderer/src/types/global.d.ts`** - TypeScript全局类型定义
- **`src/shared/errorHandling.ts`** - 集中式错误处理系统
- **`src/shared/utils.ts`** - 实用工具函数库

## 使用说明

### 导入表情包
1. 点击左侧边栏的"导入表情包"按钮
2. 选择文件夹或拖拽文件到导入区域
3. 选择目标分类和导入选项
4. 点击"开始导入"

### 管理表情包
- **搜索**：在顶部搜索框输入关键词
- **筛选**：点击筛选按钮设置详细筛选条件
- **收藏**：点击表情包上的心形图标
- **复制**：双击表情包或点击复制按钮
- **删除**：右键菜单或选择后批量删除

### 设置配置
1. 点击左侧边栏的"设置"按钮
2. 配置默认路径、主题、视图模式等
3. 点击"保存设置"

## 数据存储

- **数据库文件**：`%APPDATA%/emoji-manager-lite/emoji-manager.db`
- **表情包存储**：`%APPDATA%/emoji-manager-lite/emojis/`
- **配置文件**：存储在 SQLite 数据库中

## 开发指南

### 添加新功能
1. 在 `src/shared/types.ts` 中定义相关类型
2. 在主进程中实现业务逻辑
3. 在 `preload.ts` 中暴露 API
4. 在渲染进程中创建 UI 组件

### 数据库操作
所有数据库操作都在 `src/main/database.ts` 中实现，包括：
- 表情包 CRUD 操作
- 分类管理
- 设置存储

### 文件管理
文件相关操作在 `src/main/fileManager.ts` 中实现，包括：
- 文件导入/导出
- 图像处理
- 格式转换

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

## 最新更新

### v4.2.0 - 极致内存优化版本 (2025-10-06)

#### 🚀 性能提升

**内存占用大幅降低**
- 启动内存：400MB → **120MB** (-70%)
- 运行时内存：800MB → **150MB** (-81%)
- 峰值内存：1GB+ → **180MB** (-82%)

#### ✨ 核心优化

**智能内存管理**
- 智能视口检测 - 仅加载视口前后 100px 范围内的图片
- 即时内存释放 - 图片离开视口立即清空 src 释放内存
- 定期 GC 触发 - 每 30 秒自动触发垃圾回收和非视口图片清理
- 组件级别清理 - 组件卸载时彻底清空所有图片引用

**GPU 完全禁用**
- 禁用硬件加速、GPU 渲染、软件光栅化和 GPU 合成
- 降低 GPU 进程资源占用

**严格内存限制**
- V8 堆内存限制：256MB 老生代 + 4MB 半空间
- 针对低内存设备优化

#### 🐛 修复问题

- ✅ 修复图片长时间驻留内存的问题
- ✅ 修复滚动时内存持续增长
- ✅ 修复 GPU 进程占用过多资源
- ✅ 修复组件卸载后内存未释放
- ✅ 优化懒加载触发机制

#### ⚠️ 使用建议

**推荐配置**
- 操作系统：Windows 10/11 64位
- 最低内存：4GB RAM（推荐 8GB）
- 磁盘空间：200MB（不含表情库）

**最佳实践**
- 使用搜索功能精确查找，避免加载大量数据
- 建议每个分类 < 500 个表情
- 定期清理不常用的表情包
- 避免快速滚动浏览所有表情

**已知限制**
- Electron 基础开销约 100-120MB（Chromium 引擎必需）
- 无 GPU 加速，界面动画可能不如启用 GPU 流畅
- 超大表情库（5000+ 个）可能会卡顿
- 快速滚动时会看到图片加载过程

---

### v4.0.0 - 里程碑版本 (2025-10-01)

整合了 Phase 1-5 的所有功能，完成了完整的发布准备。

**核心功能**
- 本地管理：层级分类树、标签系统、高级搜索、导出向导
- 平台扫描：支持 8+ 平台（微信、QQ、Telegram、Discord 等）
- 增值功能：图片编辑器、多格式支持、分享功能
- 发布准备：完整测试套件、优化安装包、完善文档

---

## 完整更新日志

查看 [CHANGELOG.md](./CHANGELOG.md) 了解所有版本的详细更新历史。